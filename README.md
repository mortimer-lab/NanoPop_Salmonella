# NanoPop_Salmonella
Snakemake pipeline for automated estimation of Salmonella serovar frequencies within a mixed population using analysis of amplicon sequencing of fimH and sseL with Nanopore

## Pipeline Requirements
This pipeline requires conda for software installation and Snakemake. If you are running this pipeline on Sapelo2 or another cluster with slurm, you also need the snakemake executor plugin for slurm.

### Installing snakemake
1. Install conda or mamba. We recommend [miniforge](https://conda-forge.org/download/).
2. Install [Snakemake](https://snakemake.readthedocs.io/en/stable/getting_started/installation.html).

#### Required only if you are using slurm:

3. Install [Snakemake executor plugin: slurm](https://snakemake.github.io/snakemake-plugin-catalog/plugins/executor/slurm.html) in your snakemake conda environment.

## Pipeline Components

### envs
YAML files describing conda environments required for this pipeline

### config
Configuration files specific to your analysis. Template files have been included in this directory.

### rules
Snakemake files describing rules for pipeline components

### scripts
Custom python and R scripts for data analysis.

### Snakefile
Main Snakefile that imports rules and defines desired output. The only output that is generated by default are de novo assemblies and annotations. Uncomment other desired output.

## Required Input

### alleles
A database of alleles for each gene is required. These alleles should be in a directory with the name of the gene, and each allele should be in a separate fasta file. For example:

```
data/alleles/

fimH/
Agona-GCA_006890265.1.fasta        KentuckyI-GCA_008516425.1.fasta      Poona-GCA_008480745.1.fasta
Anatum-GCA_006839465.1.fasta       KentuckyI-GCA_008638905.1.fasta      Potsdam-GCA_006304605.1.fasta

sseL/
Agona-GCA_006890265.1.fasta        KentuckyI-GCA_008516425.1.fasta      Poona-GCA_008480745.1.fasta
Anatum-GCA_006839465.1.fasta       KentuckyI-GCA_008638905.1.fasta      Potsdam-GCA_006304605.1.fasta
```

The directory containing the alleles can be specified in the `config/config.yaml' file.

### fastqs for samples and negative control
fastq files with sequencing output for each sample and a negative control is required. The path to these fastqs should be provided in a tab-separated file with sample names in the first column and fastq paths in the second column (see example in `config/samples.tsv`). The name of your sample file can be specificied in `config/config.yaml`. Additionally, the sample name for your negative control should also be listed in this file.

## Running the pipeline

1. Clone this repository.
2. Update `config/config.yaml` and `config/samples.tsv` with information specific to your dataset.
3. Make sure all desired output is listed under `rule all:` in Snakefile
4. Run snakemake using `snakemake`. If you would like to run on a cluster using slurm, specify the profile: `snakemake --workflow-profile profiles/slurm`.

